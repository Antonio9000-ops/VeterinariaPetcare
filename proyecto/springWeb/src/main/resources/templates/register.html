<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>Registro de Usuario - Clínica Veterinaria</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Formulario de registro para el sistema de la clínica veterinaria" name="description">

    <!-- Favicon -->
    <link th:href="@{/img/favicon.ico}" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&family=Space+Grotesk&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link th:href="@{/lib/animate/animate.min.css}" rel="stylesheet">
    <link th:href="@{/lib/owlcarousel/assets/owl.carousel.min.css}" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link th:href="@{/css/style.css}" rel="stylesheet">

    <style>
        /* Estilos específicos para centrar el formulario de registro */
        .register-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 50px 15px;
        }
        .form-container {
            background: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        /* Estilos para mensajes de error/éxito (reemplazo de alert()) */
        .message-container {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 1rem;
            text-align: center;
        }
        .message-success {
            color: #155724;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .message-error {
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>

<body>
<!-- Spinner Start -->
<div id="spinner"
     class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
    <div class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>
<!-- Spinner End -->


<!-- Navbar Start (Adaptado con Register activo) -->
<div class="container-fluid sticky-top">
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light border-bottom border-2 border-white">
            <a th:href="@{/index}" class="navbar-brand">
                <h1>iSTUDIO</h1>
            </a>
            <button type="button" class="navbar-toggler ms-auto me-0" data-bs-toggle="collapse"
                    data-bs-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav ms-auto">
                    <a th:href="@{/index}" class="nav-item nav-link">Home</a>
                    <a th:href="@{/about}" class="nav-item nav-link">About</a>
                    <a th:href="@{/service}" class="nav-item nav-link">Services</a>
                    <a th:href="@{/project}" class="nav-item nav-link">Projects</a>
                    <div class="nav-item dropdown">
                        <a href="#!" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Pages</a>
                        <div class="dropdown-menu bg-light mt-2">
                            <a th:href="@{/feature}" class="dropdown-item">Features</a>
                            <a th:href="@{/team}" class="dropdown-item">Our Team</a>
                            <a th:href="@{/testimonial}" class="dropdown-item">Testimonial</a>
                            <a th:href="@{/404}" class="dropdown-item">404 Page</a>
                        </div>
                    </div>
                    <a th:href="@{/contact}" class="nav-item nav-link">Contact</a>
                    <!-- Marcamos Register como activo -->
                    <a th:href="@{/login}" class="nav-item nav-link">Login</a>
                    <a th:href="@{/register}" class="nav-item nav-link active">Register</a>
                </div>
            </div>
        </nav>
    </div>
</div>
<!-- Navbar End -->


<!-- Hero Start (Adaptado para la página de Registro) -->
<div class="container-fluid pb-5 bg-primary hero-header">
    <div class="container py-5">
        <div class="row g-3 align-items-center">
            <div class="col-lg-6 text-center text-lg-start">
                <h1 class="display-1 mb-0 animated slideInLeft">Crear Cuenta</h1>
            </div>
            <div class="col-lg-6 animated slideInRight">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb justify-content-center justify-content-lg-end mb-0">
                        <li class="breadcrumb-item"><a class="text-primary" th:href="@{/index}">Home</a></li>
                        <li class="breadcrumb-item text-secondary active" aria-current="page">Registro</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>
<!-- Hero End -->


<!-- Registration Form Start -->
<div class="container-fluid py-5">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10 register-wrapper">
                <div class="form-container wow fadeIn" data-wow-delay="0.3s">
                    <h2 class="mb-4 text-center text-primary">Regístrate en el Sistema</h2>

                    <!-- Contenedor para mensajes de éxito/error (reemplazo de alert) -->
                    <div id="message-container" class="message-container" style="display: none;"></div>

                    <form id="register-form">

                        <div class="form-group">
                            <label for="nombre" class="form-label">Nombre Completo:</label>
                            <input type="text" id="nombre" name="nombre" class="form-control form-control-lg" required>
                        </div>

                        <div class="form-group">
                            <label for="email" class="form-label">Correo Electrónico:</label>
                            <input type="email" id="email" name="email" class="form-control form-control-lg" required>
                        </div>

                        <div class="form-group">
                            <label for="contraseña" class="form-label">Contraseña:</label>
                            <input type="password" id="contraseña" name="contraseña" class="form-control form-control-lg" required>
                        </div>

                        <div class="form-group">
                            <label for="rol" class="form-label">Tipo de Usuario:</label>
                            <select id="rol" name="rol" class="form-select form-select-lg" required>
                                <option value="DUEÑO">Dueño de Mascota</option>
                                <option value="VETERINARIO">Veterinario</option>
                                <option value="ASISTENTE">Asistente</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100 mt-3">Registrarse</button>
                    </form>

                    <div class="login-link text-center mt-4">
                        <p>¿Ya tienes una cuenta? <a th:href="@{/login}" class="text-primary fw-bold">Inicia sesión aquí</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Registration Form End -->


<!-- Newsletter Start (Conservado) -->
<div class="container-fluid bg-primary newsletter p-0">
    <div class="container p-0">
        <div class="row g-0 align-items-center">
            <div class="col-md-5 ps-lg-0 text-start wow fadeIn" data-wow-delay="0.2s">
                <img class="img-fluid w-100" th:src="@{/img/newsletter.jpg}" alt="Newsletter Image">
            </div>
            <div class="col-md-7 py-5 newsletter-text wow fadeIn" data-wow-delay="0.5s">
                <div class="p-5">
                    <h1 class="mb-5">Subscribe the <span
                            class="text-uppercase text-primary bg-white px-2">Newsletter</span></h1>
                    <div class="position-relative w-100 mb-2">
                        <input class="form-control border-0 w-100 ps-4 pe-5" type="text"
                               placeholder="Enter Your Email" style="height: 60px;">
                        <button type="button" class="btn shadow-none position-absolute top-0 end-0 mt-2 me-2"><i
                                class="fa fa-paper-plane text-primary fs-4"></i></button>
                    </div>
                    <p class="mb-0">Diam sed sed dolor stet amet eirmod</p>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Newsletter End -->


<!-- Footer Start (Conservado con links Thymeleaf) -->
<div class="container-fluid bg-dark text-white-50 footer pt-5">
    <div class="container py-5">
        <div class="row g-5">
            <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.1s">
                <a th:href="@{/index}" class="d-inline-block mb-3">
                    <h1 class="text-white">iSTUDIO</h1>
                </a>
                <p class="mb-0">Tempor erat elitr rebum at clita. Diam dolor diam ipsum et tempor sit. Aliqu diam
                    amet diam et eos labore. Clita erat ipsum et lorem et sit, sed stet no labore lorem sit. Sanctus
                    clita duo justo et tempor</p>
            </div>
            <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.3s">
                <h5 class="text-white mb-4">Get In Touch</h5>
                <p><i class="fa fa-map-marker-alt me-3"></i>123 Street, New York, USA</p>
                <p><i class="fa fa-phone-alt me-3"></i>+012 345 67890</p>
                <p><i class="fa fa-envelope me-3"></i>info@example.com</p>
                <div class="d-flex pt-2">
                    <a class="btn btn-outline-primary btn-square border-2 me-2" href="#!"><i
                            class="fab fa-twitter"></i></a>
                    <a class="btn btn-outline-primary btn-square border-2 me-2" href="#!"><i
                            class="fab fa-facebook-f"></i></a>
                    <a class="btn btn-outline-primary btn-square border-2 me-2" href="#!"><i
                            class="fab fa-youtube"></i></a>
                    <a class="btn btn-outline-primary btn-square border-2 me-2" href="#!"><i
                            class="fab fa-instagram"></i></a>
                    <a class="btn btn-outline-primary btn-square border-2 me-2" href="#!"><i
                            class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.5s">
                <h5 class="text-white mb-4">Popular Link</h5>
                <a class="btn btn-link" href="#!">About Us</a>
                <a class="btn btn-link" href="#!">Contact Us</a>
                <a class="btn btn-link" href="#!">Privacy Policy</a>
                <a class="btn btn-link" href="#!">Terms &amp; Condition</a>
                <a class="btn btn-link" href="#!">Career</a>
            </div>
            <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.7s">
                <h5 class="text-white mb-4">Our Services</h5>
                <a class="btn btn-link" href="#!">Interior Design</a>
                <a class="btn btn-link" href="#!">Project Planning</a>
                <a class="btn btn-link" href="#!">Renovation</a>
                <a class="btn btn-link" href="#!">Implement</a>
                <a class="btn btn-link" href="#!">Landscape Design</a>
            </div>
        </div>
    </div>
    <div class="container wow fadeIn" data-wow-delay="0.1s">
        <div class="copyright">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    &copy; <a class="border-bottom" href="#!">Your Site Name</a>, All Right Reserved.

                    <!--/*** This template is free as long as you keep the below author’s credit link/attribution link/backlink. ***/-->
                    <!--/*** If you'd like to use the template without the below author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". ***/-->
                    Designed By <a class="border-bottom" href="https://htmlcodex.com">HTML Codex</a>. Distributed by
                    <a class="border-bottom" href="https://themewagon.com" target="_blank">ThemeWagon</a>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <div class="footer-menu">
                        <a href="#!">Home</a>
                        <a href="#!">Cookies</a>
                        <a href="#!">Help</a>
                        <a href="#!">FAQs</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Footer End -->


<!-- Back to Top (Conservado) -->
<a href="#!" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>


<!-- JavaScript Libraries (Rutas Thymeleaf) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/lib/wow/wow.min.js}"></script>
<script th:src="@{/lib/easing/easing.min.js}"></script>
<script th:src="@{/lib/waypoints/waypoints.min.js}"></script>
<script th:src="@{/lib/owlcarousel/owl.carousel.min.js}"></script>
<script th:src="@{/js/main.js}"></script>

<!-- Script de Funcionalidad de Registro -->
<script>
    new WOW().init();

    document.getElementById('register-form').addEventListener('submit', async function(event) {
        event.preventDefault();

        const messageContainer = document.getElementById('message-container');
        messageContainer.style.display = 'none';
        messageContainer.classList.remove('message-success', 'message-error');
        messageContainer.textContent = ''; // Limpiar mensaje anterior

        const registerData = {
            nombre: document.getElementById('nombre').value,
            email: document.getElementById('email').value,
            contraseña: document.getElementById('contraseña').value,
            rol: document.getElementById('rol').value
        };

        // Simular un loading (opcional, pero mejora la UX)
        const submitButton = event.target.querySelector('button[type="submit"]');
        submitButton.textContent = 'Registrando...';
        submitButton.disabled = true;

        try {
            // Usamos la ruta sugerida /auth/register
            const response = await fetch('/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(registerData)
            });

            if (response.ok) {
                messageContainer.textContent = '¡Registro exitoso! Serás redirigido al login.';
                messageContainer.classList.add('message-success');
                messageContainer.style.display = 'block';

                // Redirigir después de 2 segundos
                setTimeout(() => {
                    window.location.href = '/login';
                }, 2000);

            } else {
                const errorText = await response.text();
                // Intenta parsear el error si tu backend envía un mensaje útil
                let errorMessage = 'Error en el registro. El email puede que ya esté en uso o la contraseña no es válida.';
                try {
                    const errorJson = JSON.parse(errorText);
                    if (errorJson.message) {
                        errorMessage = errorJson.message;
                    }
                } catch (e) {
                    console.warn("Respuesta de error no JSON. Usando mensaje por defecto.");
                }

                messageContainer.textContent = errorMessage;
                messageContainer.classList.add('message-error');
                messageContainer.style.display = 'block';
            }
        } catch (error) {
            console.error("Error en la solicitud de registro:", error);
            messageContainer.textContent = 'Error de conexión. Inténtalo de nuevo.';
            messageContainer.classList.add('message-error');
            messageContainer.style.display = 'block';
        } finally {
            submitButton.textContent = 'Registrarse';
            submitButton.disabled = false;
        }
    });
</script>
</body>

</html>
