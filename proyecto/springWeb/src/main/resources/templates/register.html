<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>PetCare - Registro</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Formulario de registro para el sistema de la clínica veterinaria" name="description">

    <link th:href="@{/img/favicon.ico}" rel="icon">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&family=Space+Grotesk&display=swap" rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <link th:href="@{/lib/animate/animate.min.css}" rel="stylesheet">
    <link th:href="@{/lib/owlcarousel/assets/owl.carousel.min.css}" rel="stylesheet">

    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">

    <link th:href="@{/css/style.css}" rel="stylesheet">

    <style>
        .register-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 50px 15px;
        }
        .form-container {
            background: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .message-container {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 1rem;
            text-align: center;
        }
        .message-success {
            color: #155724;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .message-error {
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>

<body>
<div id="spinner"
     class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
    <div class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>

<div class="container-fluid sticky-top">
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light border-bottom border-2 border-white">
            <a th:href="@{/index}" class="navbar-brand">
                <h1>PetCare</h1>
            </a>
            <button type="button" class="navbar-toggler ms-auto me-0" data-bs-toggle="collapse"
                    data-bs-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav ms-auto" id="nav-links-menu">
                    <a th:href="@{/}" class="nav-item nav-link active">Inicio</a>
                    <a th:href="@{/contact}" class="nav-item nav-link">Contacto de emergencia</a>
                    <p class="nav-item nav-link text-muted">Cargando...</p>
                </div>
            </div>
        </nav>
    </div>
</div>

<div class="container-fluid pb-5 bg-primary hero-header">
    <div class="container py-5">
        <div class="row g-3 align-items-center">
            <div class="col-lg-6 text-center text-lg-start">
                <h1 class="display-1 mb-0 animated slideInLeft">Crear Cuenta</h1>
            </div>
            <div class="col-lg-6 animated slideInRight">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb justify-content-center justify-content-lg-end mb-0">
                        <li class="breadcrumb-item"><a class="text-primary" th:href="@{/index}">Home</a></li>
                        <li class="breadcrumb-item text-secondary active" aria-current="page">Registro</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid py-5">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10 register-wrapper">
                <div class="form-container wow fadeIn" data-wow-delay="0.3s">
                    <h2 class="mb-4 text-center text-primary">Regístrate en el Sistema</h2>

                    <div id="message-container" class="message-container" style="display: none;"></div>

                    <form id="register-form">

                        <div class="form-group">
                            <label for="nombre" class="form-label">Nombre Completo:</label>
                            <input type="text" id="nombre" name="nombre" class="form-control form-control-lg" required>
                        </div>

                        <div class="form-group">
                            <label for="email" class="form-label">Correo Electrónico:</label>
                            <input type="email" id="email" name="email" class="form-control form-control-lg" required>
                        </div>

                        <div class="form-group">
                            <label for="contraseña" class="form-label">Contraseña:</label>
                            <input type="password" id="contraseña" name="contraseña" class="form-control form-control-lg" required>
                        </div>

                        <div class="form-group">
                            <label for="rol" class="form-label">Tipo de Usuario:</label>
                            <select id="rol" name="rol" class="form-select form-select-lg" required>
                                <option value="DUEÑO">Dueño de Mascota</option>
                                <option value="VETERINARIO">Veterinario</option>
                                <option value="ASISTENTE">Asistente</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100 mt-3">Registrarse</button>
                    </form>

                    <div class="login-link text-center mt-4">
                        <p>¿Ya tienes una cuenta? <a th:href="@{/login}" class="text-primary fw-bold">Inicia sesión aquí</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid bg-primary newsletter p-0">
    <div class="container p-0">
        <div class="row g-0 align-items-center">
            <div class="col-md-5 ps-lg-0 text-start wow fadeIn" data-wow-delay="0.2s">
                <img class="img-fluid w-100" th:src="@{/img/newsletter.jpg}" alt="Newsletter Image">
            </div>
            <div class="col-md-7 py-5 newsletter-text wow fadeIn" data-wow-delay="0.5s">
                <div class="p-5">
                    <h1 class="mb-5">Subscribe the <span
                            class="text-uppercase text-primary bg-white px-2">Newsletter</span></h1>
                    <div class="position-relative w-100 mb-2">
                        <input class="form-control border-0 w-100 ps-4 pe-5" type="text"
                               placeholder="Enter Your Email" style="height: 60px;">
                        <button type="button" class="btn shadow-none position-absolute top-0 end-0 mt-2 me-2"><i
                                class="fa fa-paper-plane text-primary fs-4"></i></button>
                    </div>
                    <p class="mb-0">Diam sed sed dolor stet amet eirmod</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid footer pt-5">
    <div class="container py-5">
        <div class="row g-5">
            <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.1s">
                <a th:href="@{/index}" class="d-inline-block mb-3">
                    <h1 class="text">PetCare</h1>
                </a>
                <p class="mb-0">Tempor erat elitr rebum at clita. Diam dolor diam ipsum et tempor sit. Aliqu diam
                    amet diam et eos labore. Clita erat ipsum et lorem et sit, sed stet no labore lorem sit. Sanctus
                    clita duo justo et tempor</p>
            </div>
            <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.3s">
                <h5 class="text-white mb-4">Contáctanos</h5>
                <p><i class="fa fa-map-marker-alt me-3"></i>123 Street, New York, USA</p>
                <p><i class="fa fa-phone-alt me-3"></i>+012 345 67890</p>
                <p><i class="fa fa-envelope me-3"></i>info@example.com</p>
                <div class="d-flex pt-2">
                    <a class="btn btn-outline-primary btn-square border-2 me-2" href="#!"><i
                            class="fab fa-twitter"></i></a>
                    <a class="btn btn-outline-primary btn-square border-2 me-2" href="#!"><i
                            class="fab fa-facebook-f"></i></a>
                    <a class="btn btn-outline-primary btn-square border-2 me-2" href="#!"><i
                            class="fab fa-youtube"></i></a>
                    <a class="btn btn-outline-primary btn-square border-2 me-2" href="#!"><i
                            class="fab fa-instagram"></i></a>
                    <a class="btn btn-outline-primary btn-square border-2 me-2" href="#!"><i
                            class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.5s">
                <h5 class="text-white mb-4">Enlaces Populares</h5>
                <a class="btn btn-link" th:href="@{/about}">Acerca de Nosotros</a>
                <a class="btn btn-link" th:href="@{/contact}">Contáctanos</a>
                <a class="btn btn-link" href="#!">Política de Privacidad</a>
                <a class="btn btn-link" href="#!">Términos &amp; Condiciones</a>
                <a class="btn btn-link" href="#!">Carrera</a>
            </div>
            <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.7s">
                <h5 class="text-white mb-4">Nuestros Servicios</h5>
                <a class="btn btn-link" th:href="@{/service}">Diseño Interior</a>
                <a class="btn btn-link" th:href="@{/service}">Planificación de Proyectos</a>
                <a class="btn btn-link" th:href="@{/service}">Renovación</a>
                <a class="btn btn-link" th:href="@{/service}">Implementación</a>
                <a class="btn btn-link" th:href="@{/service}">Diseño de Paisajes</a>
            </div>
        </div>
    </div>
    <div class="container wow fadeIn" data-wow-delay="0.1s">
        <div class="copyright">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    &copy; <a class="border-bottom" href="#!">Your Site Name</a>, All Right Reserved.
                    Designed By <a class="border-bottom" href="https://htmlcodex.com">HTML Codex</a>. Distributed by
                    <a class="border-bottom" href="https://themewagon.com" target="_blank">ThemeWagon</a>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <div class="footer-menu">
                        <a th:href="@{/index}">Home</a>
                        <a href="#!">Cookies</a>
                        <a href="#!">Ayuda</a>
                        <a href="#!">FAQs</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<a href="#!" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/lib/wow/wow.min.js}"></script>
<script th:src="@{/lib/easing/easing.min.js}"></script>
<script th:src="@{/lib/waypoints/waypoints.min.js}"></script>
<script th:src="@{/lib/owlcarousel/owl.carousel.min.js}"></script>
<script th:src="@{/js/main.js}"></script>

<script>
    new WOW().init();

    document.getElementById('register-form').addEventListener('submit', async function(event) {
        event.preventDefault();

        const messageContainer = document.getElementById('message-container');
        messageContainer.style.display = 'none';
        messageContainer.classList.remove('message-success', 'message-error');
        messageContainer.textContent = '';

        const registerData = {
            nombre: document.getElementById('nombre').value,
            email: document.getElementById('email').value,
            contraseña: document.getElementById('contraseña').value,
            rol: document.getElementById('rol').value
        };

        const submitButton = event.target.querySelector('button[type="submit"]');
        submitButton.textContent = 'Registrando...';
        submitButton.disabled = true;

        try {
            const response = await fetch('/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(registerData)
            });

            if (response.ok) {
                messageContainer.textContent = '¡Registro exitoso! Serás redirigido al login.';
                messageContainer.classList.add('message-success');
                messageContainer.style.display = 'block';

                setTimeout(() => {
                    window.location.href = '/login';
                }, 2000);

            } else {
                const errorText = await response.text();
                let errorMessage = 'Error en el registro. El email puede que ya esté en uso o la contraseña no es válida.';
                try {
                    const errorJson = JSON.parse(errorText);
                    if (errorJson.message) {
                        errorMessage = errorJson.message;
                    }
                } catch (e) {
                    console.warn("Respuesta de error no JSON. Usando mensaje por defecto.");
                }

                messageContainer.textContent = errorMessage;
                messageContainer.classList.add('message-error');
                messageContainer.style.display = 'block';
            }
        } catch (error) {
            console.error("Error en la solicitud de registro:", error);
            messageContainer.textContent = 'Error de conexión. Inténtalo de nuevo.';
            messageContainer.classList.add('message-error');
            messageContainer.style.display = 'block';
        } finally {
            submitButton.textContent = 'Registrarse';
            submitButton.disabled = false;
        }
    });
</script>
</body>

</html>
