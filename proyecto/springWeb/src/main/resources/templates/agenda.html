<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <title>PetCare - Listado General de Mascotas</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta
      content="Listado general de todas las mascotas en el sistema"
      name="keywords"
    />
    <meta
      content="Visualización y gestión de todas las mascotas registradas"
      name="description"
    />

    <link th:href="@{/img/favicon.ico}" rel="icon" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans&family=Space+Grotesk&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <link th:href="@{/lib/animate/animate.min.css}" rel="stylesheet" />
    <link
      th:href="@{/lib/owlcarousel/assets/owl.carousel.min.css}"
      rel="stylesheet"
    />

    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" />

    <link th:href="@{/css/style.css}" rel="stylesheet" />

    <style>
      .container-listado {
        min-height: 70vh;
        padding: 50px 0;
      }

      .table-custom {
        width: 100%;
        margin-top: 20px;
        border-collapse: separate;
        border-spacing: 0 10px;
      }

      .table-custom th,
      .table-custom td {
        padding: 15px;
        vertical-align: middle;
        background: #ffffff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .table-custom thead th {
        background-color: var(--bs-primary);
        color: white;
        border: none;
        padding: 12px 15px;
        font-size: 1rem;
        text-align: left;
      }

      .table-custom tbody tr {
        transition: all 0.2s;
        border-left: 4px solid transparent;
      }

      .table-custom tbody tr:hover {
        border-left: 4px solid var(--bs-secondary);
      }

      .table-custom tbody td:first-child {
        border-top-left-radius: 6px;
        border-bottom-left-radius: 6px;
      }

      .table-custom tbody td:last-child {
        border-top-right-radius: 6px;
        border-bottom-right-radius: 6px;
      }

      .table-custom .btn {
        padding: 8px 15px;
        font-size: 0.9rem;
        border-radius: 5px;
      }
    </style>
  </head>

  <body>
    <div
      id="spinner"
      class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center"
    >
      <div
        class="spinner-grow text-primary"
        style="width: 3rem; height: 3rem"
        role="status"
      >
        <span class="sr-only">Cargando...</span>
      </div>
    </div>
    <div class="container-fluid sticky-top">
      <div class="container">
        <nav
          class="navbar navbar-expand-lg navbar-light border-bottom border-2 border-white"
        >
          <a th:href="@{/}" class="navbar-brand">
            <h1>PetCare</h1>
          </a>
          <button
            type="button"
            class="navbar-toggler ms-auto me-0"
            data-bs-toggle="collapse"
            data-bs-target="#navbarCollapse"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ms-auto" id="nav-links-menu">
              <a th:href="@{/}" class="nav-item nav-link">Inicio</a>
              <a th:href="@{/gestion-citas}" class="nav-item nav-link"
                >Gestión Citas</a
              >
              <a th:href="@{/agenda}" class="nav-item nav-link active"
                >Mascotas</a
              >
              <a th:href="@{/gestion-servicios}" class="nav-item nav-link"
                >Gestion de Servicios</a
              >
              <a th:href="@{/contact}" class="nav-item nav-link"
                >Contacto de emergencia</a
              >
              <a href="#" id="logout-btn-menu" class="nav-item nav-link"
                >Cerrar Sesión</a
              >
            </div>
          </div>
        </nav>
      </div>
    </div>
    <div class="container-fluid pb-5 bg-primary hero-header">
      <div class="container py-5">
        <div class="row g-3 align-items-center">
          <div class="col-lg-8 text-center text-lg-start">
            <h1 class="display-1 mb-0 animated slideInLeft" id="hero-title">
              Listado General de Mascotas
            </h1>
            <p class="text-white mt-3 animated slideInLeft">
              Aquí se muestran todas las mascotas registradas en el sistema.
            </p>
          </div>
          <div class="col-lg-4 text-center text-lg-end">
            <button
              class="btn btn-secondary py-3 px-5 animated slideInRight"
              onclick="history.back()"
            >
              Volver Atrás <i class="fa fa-arrow-left ms-2"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid py-5 bg-white container-listado">
      <div class="container">
        <div class="row wow fadeIn" data-wow-delay="0.3s">
          <div class="col-12">
            <div class="table-responsive">
              <table class="table-custom table-borderless">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Especie</th>
                    <th>Raza</th>
                    <th>Dueño</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="mascotas-tbody">
                  <tr>
                    <td colspan="5" class="text-center text-muted py-5">
                      Cargando listado de mascotas...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid footer pt-5">
      <div class="container py-5">
        <div class="row g-5">
          <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.1s">
            <a th:href="@{/index}" class="d-inline-block mb-3">
              <h1 class="text">PetCare</h1>
            </a>
            <p class="mb-0">
              Tempor erat elitr rebum at clita. Diam dolor diam ipsum et tempor
              sit. Aliqu diam amet diam et eos labore. Clita erat ipsum et lorem
              et sit, sed stet no labore lorem sit. Sanctus clita duo justo et
              tempor
            </p>
          </div>
          <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.3s">
            <h5 class="text-white mb-4">Contáctanos</h5>
            <p>
              <i class="fa fa-map-marker-alt me-3"></i>123 Street, New York, USA
            </p>
            <p><i class="fa fa-phone-alt me-3"></i>+012 345 67890</p>
            <p><i class="fa fa-envelope me-3"></i>info@example.com</p>
            <div class="d-flex pt-2">
              <a
                class="btn btn-outline-primary btn-square border-2 me-2"
                href="#!"
                ><i class="fab fa-twitter"></i
              ></a>
              <a
                class="btn btn-outline-primary btn-square border-2 me-2"
                href="#!"
                ><i class="fab fa-facebook-f"></i
              ></a>
              <a
                class="btn btn-outline-primary btn-square border-2 me-2"
                href="#!"
                ><i class="fab fa-youtube"></i
              ></a>
              <a
                class="btn btn-outline-primary btn-square border-2 me-2"
                href="#!"
                ><i class="fab fa-instagram"></i
              ></a>
              <a
                class="btn btn-outline-primary btn-square border-2 me-2"
                href="#!"
                ><i class="fab fa-linkedin-in"></i
              ></a>
            </div>
          </div>
          <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.5s">
            <h5 class="text-white mb-4">Enlaces Populares</h5>
            <a class="btn btn-link" th:href="@{/about}">Acerca de Nosotros</a>
            <a class="btn btn-link" th:href="@{/contact}">Contáctanos</a>
            <a class="btn btn-link" href="#!">Política de Privacidad</a>
            <a class="btn btn-link" href="#!">Términos &amp; Condiciones</a>
            <a class="btn btn-link" href="#!">Carrera</a>
          </div>
          <div class="col-md-6 col-lg-3 wow fadeIn" data-wow-delay="0.7s">
            <h5 class="text-white mb-4">Nuestros Servicios</h5>
            <a class="btn btn-link" th:href="@{/service}">Diseño Interior</a>
            <a class="btn btn-link" th:href="@{/service}"
              >Planificación de Proyectos</a
            >
            <a class="btn btn-link" th:href="@{/service}">Renovación</a>
            <a class="btn btn-link" th:href="@{/service}">Implementación</a>
            <a class="btn btn-link" th:href="@{/service}">Diseño de Paisajes</a>
          </div>
        </div>
      </div>
      <div class="container wow fadeIn" data-wow-delay="0.1s">
        <div class="copyright">
          <div class="row">
            <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
              &copy; <a class="border-bottom" href="#!">Your Site Name</a>, All
              Right Reserved. Designed By
              <a class="border-bottom" href="https://htmlcodex.com"
                >HTML Codex</a
              >. Distributed by
              <a
                class="border-bottom"
                href="https://themewagon.com"
                target="_blank"
                >ThemeWagon</a
              >
            </div>
            <div class="col-md-6 text-center text-md-end">
              <div class="footer-menu">
                <a th:href="@{/index}">Home</a>
                <a href="#!">Cookies</a>
                <a href="#!">Ayuda</a>
                <a href="#!">FAQs</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <a href="#!" class="btn btn-lg btn-primary btn-lg-square back-to-top"
      ><i class="bi bi-arrow-up"></i
    ></a>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/lib/wow/wow.min.js}"></script>
    <script th:src="@{/lib/easing/easing.min.js}"></script>
    <script th:src="@{/lib/waypoints/waypoints.min.js}"></script>
    <script th:src="@{/lib/owlcarousel/owl.carousel.min.js}"></script>

    <script th:src="@{/js/main.js}"></script>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("jwt_token");
        if (window.WOW) {
          new WOW().init();
        }

        // Lógica de Redirección y Fetch
        if (!token) {
          window.location.href = "/login";
          return;
        }

        const tbody = document.getElementById("mascotas-tbody");
        tbody.innerHTML = "";

        try {
          const response = await fetch(`/api/mascotas`, {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (!response.ok) {
            throw new Error(
              "No se pudieron cargar las mascotas. Código: " + response.status
            );
          }

          const mascotas = await response.json();

          if (mascotas.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="5" class="text-center text-muted py-3">No hay mascotas registradas en el sistema.</td></tr>';
            return;
          }

          tbody.innerHTML = "";

          mascotas.forEach((mascota) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                        <td>${mascota.nombre}</td>
                        <td>${mascota.especie}</td>
                        <td>${mascota.raza}</td>
                        <td>${mascota.nombreDueno || "N/A"}</td> <td>
                            <a href="/mascota-detalle?id=${
                              mascota.id
                            }" class="btn btn-outline-info border-2">Ver Ficha</a>
                        </td>
                    `;
            tbody.appendChild(tr);
          });
        } catch (error) {
          tbody.innerHTML = `<tr><td colspan="5" class="text-center alert-danger py-3">Error al cargar las mascotas: ${error.message}</td></tr>`;
        }
      });

      document.addEventListener("DOMContentLoaded", () => {
        const logoutBtn = document.getElementById("logout-btn-menu");

        if (logoutBtn) {
          logoutBtn.addEventListener("click", (e) => {
            e.preventDefault();

            localStorage.removeItem("jwt_token");

            alert("Has cerrado la sesión.");

            window.location.href = "/";
          });
        }
      });
    </script>
  </body>
</html>
